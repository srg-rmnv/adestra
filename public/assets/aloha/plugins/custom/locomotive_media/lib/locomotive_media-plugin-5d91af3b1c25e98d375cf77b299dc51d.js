define(["aloha/jquery","aloha/plugin","ui/ui","ui/button","i18n!aloha/nls/i18n","i18n!locomotive_media/nls/i18n","css!locomotive_media/css/image.css"],function(e,t,n,r,i,o){var a=e,s=window.GENTICS,l=window.Aloha;return t.create("locomotive_media",{init:function(){this._addUIInsertButton()},openDialog:function(){var e=this,t=window.parent.application_view.content_assets_picker_view;t.options.on_select=function(n){1==n.get("image")?e.insertImg(n):e.insertLink(n),t.close()},t.fetch_assets()},insertImg:function(e){var t,n,r,i=l.Selection.getRangeObject(),o=e.get("url");i.isCollapsed()?(t="max-width: "+e.get("width")+"; max-height: "+e.get("height"),n='<img style="'+t+'" src="'+o+'" title="" />',r=a(n),s.Utils.Dom.insertIntoDOM(r,i,a(l.activeEditable.obj))):l.Log.error("media cannot markup a selection")},insertLink:function(e){var t,n,r=l.Selection.getRangeObject(),i=e.get("filename"),o=e.get("url");r.isCollapsed()?(t='<a href="'+o+'">'+i+"</a>",n=a(t),s.Utils.Dom.insertIntoDOM(n,r,a(l.activeEditable.obj)),r.startContainer=r.endContainer=n.contents().get(0),r.startOffset=0,r.endOffset=i.length):(t='<a href="'+o+'"></a>',n=a(t),s.Utils.Dom.addMarkup(r,n,!1))},_addUIInsertButton:function(){{var e=this;n.adopt("insertlocomotivemedia",r,{tooltip:o.t("button.addimg.tooltip"),icon:"aloha-button aloha-locomotive-media-insert",scope:"Aloha.continuoustext",click:function(){e.openDialog()}})}}})});